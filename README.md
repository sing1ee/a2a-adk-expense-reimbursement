# ADKè´¹ç”¨æŠ¥é”€ä»£ç† (Expense Reimbursement Agent)

è¿™æ˜¯ä¸€ä¸ªåŸºäºGoogle Agent Development Kit (ADK)å¼€å‘çš„è´¹ç”¨æŠ¥é”€æ™ºèƒ½ä»£ç†ï¼Œä½œä¸º[Agent2Agent](https://a2aprotocol.ai/) ([A2A](https://a2aprotocol.ai/))æœåŠ¡å™¨è¿è¡Œã€‚è¯¥ä»£ç†çš„æ ¸å¿ƒç‰¹æ€§æ˜¯**æ™ºèƒ½è¡¨å•ç”Ÿæˆ**ï¼šå½“ç”¨æˆ·çš„æŠ¥é”€è¯·æ±‚ç¼ºå°‘å¿…è¦ä¿¡æ¯æ—¶ï¼Œä»£ç†ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªè¡¨å•ä¾›ç”¨æˆ·å¡«å†™ï¼Œç¡®ä¿æ”¶é›†åˆ°å®Œæ•´çš„æŠ¥é”€ä¿¡æ¯åå†è¿›è¡Œå¤„ç†ã€‚

## ğŸ¯ é¡¹ç›®ç‰¹è‰²

- **æ™ºèƒ½è¡¨å•äº¤äº’**ï¼šè‡ªåŠ¨æ£€æµ‹ç¼ºå¤±ä¿¡æ¯å¹¶ç”ŸæˆåŠ¨æ€è¡¨å•
- **[A2A](https://a2aprotocol.ai/)åè®®æ”¯æŒ**ï¼šæ ‡å‡†åŒ–çš„ä»£ç†é—´é€šä¿¡åè®®
- **æµå¼å¤„ç†**ï¼šæ”¯æŒå®æ—¶å“åº”å’ŒçŠ¶æ€æ›´æ–°
- **Google ADKé›†æˆ**ï¼šåŸºäºGoogleæœ€æ–°çš„ä»£ç†å¼€å‘å·¥å…·åŒ…

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- Python 3.12 æˆ–æ›´é«˜ç‰ˆæœ¬
- [UV](https://docs.astral.sh/uv/) åŒ…ç®¡ç†å·¥å…·
- Google API Key (Geminiæ¨¡å‹è®¿é—®æƒé™)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è·å–Google API Key

1. è®¿é—® [Google AI Studio](https://aistudio.google.com/)
2. ç™»å½•æ‚¨çš„Googleè´¦æˆ·
3. ç‚¹å‡»"Get API key"
4. åˆ›å»ºæ–°çš„API keyæˆ–ä½¿ç”¨ç°æœ‰çš„
5. å¤åˆ¶API keyå¤‡ç”¨

### 2. ç¯å¢ƒé…ç½®

```bash
# å…‹éš†é¡¹ç›®åˆ°æœ¬åœ°ï¼ˆå¦‚æœéœ€è¦ï¼‰
cd a2a-adk-expense-reimbursement

# åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶
echo "GOOGLE_API_KEY=your_api_key_here" > .env

# æ›¿æ¢your_api_key_hereä¸ºæ‚¨çš„å®é™…API key
```

### 3. å®‰è£…ä¾èµ–å’Œè¿è¡Œ

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source .venv/bin/activate

# ä½¿ç”¨uvè¿è¡Œé¡¹ç›®
uv run .
```

æœåŠ¡å™¨å°†åœ¨ `http://localhost:10002` å¯åŠ¨ã€‚

### 4. ä½¿ç”¨CLIå®¢æˆ·ç«¯æµ‹è¯•

æ‰“å¼€æ–°çš„ç»ˆç«¯çª—å£ï¼š

```bash
# å¯¼èˆªåˆ°CLIå®¢æˆ·ç«¯ç›®å½•ï¼ˆå‡è®¾åœ¨samples/python/hosts/cliï¼‰
cd samples/python/hosts/cli

# è¿æ¥åˆ°æŠ¥é”€ä»£ç†
uv run . --agent http://localhost:10002
```

### 5. æµ‹è¯•äº¤äº’ç¤ºä¾‹

åœ¨CLIå®¢æˆ·ç«¯ä¸­è¾“å…¥ä»¥ä¸‹æµ‹è¯•å‘½ä»¤ï¼š

```
# ç¤ºä¾‹1ï¼šç¼ºå°‘ä¿¡æ¯çš„è¯·æ±‚ï¼ˆä¼šè§¦å‘è¡¨å•ï¼‰
æˆ‘éœ€è¦æŠ¥é”€$20çš„åˆé¤è´¹

# ç¤ºä¾‹2ï¼šå®Œæ•´ä¿¡æ¯çš„è¯·æ±‚
æˆ‘éœ€è¦æŠ¥é”€2024å¹´1æœˆ15æ—¥çš„$50å®¢æˆ·åˆé¤è´¹ç”¨

# ç¤ºä¾‹3ï¼šéƒ¨åˆ†ä¿¡æ¯çš„è¯·æ±‚
è¯·å¸®æˆ‘æŠ¥é”€æ˜¨å¤©çš„äº¤é€šè´¹$25
```

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### æ ¸å¿ƒæ–‡ä»¶ç»“æ„

```
a2a-adk-expense-reimbursement/
â”œâ”€â”€ __main__.py          # æœåŠ¡å™¨å¯åŠ¨å…¥å£
â”œâ”€â”€ agent.py             # æ ¸å¿ƒä»£ç†é€»è¾‘
â”œâ”€â”€ agent_executor.py    # A2Aè¯·æ±‚æ‰§è¡Œå™¨
â”œâ”€â”€ pyproject.toml       # é¡¹ç›®é…ç½®å’Œä¾èµ–
â””â”€â”€ README.md           # é¡¹ç›®æ–‡æ¡£
```

### ä¸»è¦ç»„ä»¶è¯´æ˜

#### 1. `__main__.py` - æœåŠ¡å™¨å…¥å£
- é…ç½®[A2A](https://a2aprotocol.ai/)æœåŠ¡å™¨å’Œä»£ç†ä¿¡æ¯
- è®¾ç½®ä»£ç†æŠ€èƒ½å’Œèƒ½åŠ›æè¿°
- å¯åŠ¨HTTPæœåŠ¡å™¨ç›‘å¬è¯·æ±‚

#### 2. `agent.py` - æ ¸å¿ƒä»£ç†é€»è¾‘
åŒ…å«ä¸‰ä¸ªå…³é”®å·¥å…·å‡½æ•°ï¼š

- **`create_request_form()`**: åˆ›å»ºæŠ¥é”€è¡¨å•æ¨¡æ¿
- **`return_form()`**: å°†è¡¨å•å°è£…ä¸º[A2A](https://a2aprotocol.ai/)åè®®æ ¼å¼è¿”å›
- **`reimburse()`**: æ‰§è¡Œå®é™…çš„æŠ¥é”€å®¡æ‰¹æ“ä½œ

#### 3. `agent_executor.py` - è¯·æ±‚æ‰§è¡Œå™¨
- å¤„ç†[A2A](https://a2aprotocol.ai/)åè®®çš„è¯·æ±‚å’Œå“åº”
- ç®¡ç†ä»»åŠ¡çŠ¶æ€ï¼ˆå·¥ä½œä¸­ã€éœ€è¦è¾“å…¥ã€å·²å®Œæˆç­‰ï¼‰
- åè°ƒä»£ç†ä¸[A2A](https://a2aprotocol.ai/)æœåŠ¡å™¨çš„é€šä¿¡

## ğŸ”„ æ ¸å¿ƒå·¥ä½œæµç¨‹

ä»¥ä¸‹æ—¶åºå›¾å±•ç¤ºäº†æŠ¥é”€ä»£ç†çš„å®Œæ•´äº¤äº’æµç¨‹ï¼š

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·/CLIå®¢æˆ·ç«¯
    participant Server as A2AæœåŠ¡å™¨
    participant Agent as æŠ¥é”€ä»£ç†
    participant LLM as Gemini 2.0 Flash

    User->>Server: å‘é€æŠ¥é”€è¯·æ±‚<br/>"æˆ‘éœ€è¦æŠ¥é”€$20çš„åˆé¤è´¹"
    Server->>Agent: è½¬å‘ç”¨æˆ·è¯·æ±‚
    Agent->>LLM: åˆ†æè¯·æ±‚å†…å®¹
    LLM->>Agent: è¯†åˆ«ç¼ºå°‘æ—¥æœŸç­‰ä¿¡æ¯
    Agent->>Agent: è°ƒç”¨create_request_form()
    Agent->>Agent: è°ƒç”¨return_form()
    Agent->>Server: è¿”å›è¡¨å•ç»“æ„
    Server->>User: è¿”å›JSONè¡¨å•<br/>åŒ…å«æ—¥æœŸã€é‡‘é¢ã€ç›®çš„å­—æ®µ
    
    User->>User: ç”¨æˆ·å¡«å†™è¡¨å•<br/>æ—¥æœŸã€é‡‘é¢ã€ç›®çš„
    User->>Server: æäº¤å¡«å†™å®Œæ•´çš„è¡¨å•
    Server->>Agent: è½¬å‘è¡¨å•æ•°æ®
    Agent->>LLM: éªŒè¯è¡¨å•å®Œæ•´æ€§
    LLM->>Agent: ç¡®è®¤ä¿¡æ¯å®Œæ•´
    Agent->>Agent: è°ƒç”¨reimburse(request_id)
    Agent->>Server: è¿”å›å®¡æ‰¹ç»“æœ
    Server->>User: è¿”å›æœ€ç»ˆç»“æœ<br/>"æŠ¥é”€å·²æ‰¹å‡†"
```

### å·¥ä½œæµç¨‹è¯¦è§£

1. **è¯·æ±‚æ¥æ”¶**ï¼šç”¨æˆ·é€šè¿‡CLIå®¢æˆ·ç«¯å‘é€æŠ¥é”€è¯·æ±‚
2. **æ™ºèƒ½åˆ†æ**ï¼šGeminiæ¨¡å‹åˆ†æè¯·æ±‚ï¼Œè¯†åˆ«ç¼ºå¤±çš„å¿…è¦ä¿¡æ¯
3. **è¡¨å•ç”Ÿæˆ**ï¼šå¦‚æœä¿¡æ¯ä¸å®Œæ•´ï¼Œè‡ªåŠ¨ç”ŸæˆåŒ…å«æ‰€éœ€å­—æ®µçš„è¡¨å•
4. **ç”¨æˆ·äº¤äº’**ï¼šç”¨æˆ·å¡«å†™è¡¨å•è¡¥å……ç¼ºå¤±ä¿¡æ¯
5. **ä¿¡æ¯éªŒè¯**ï¼šéªŒè¯è¡¨å•æ•°æ®çš„å®Œæ•´æ€§å’Œæœ‰æ•ˆæ€§
6. **æŠ¥é”€å¤„ç†**ï¼šæ‰§è¡ŒæŠ¥é”€å®¡æ‰¹å¹¶è¿”å›ç»“æœ

## ğŸ› ï¸ é«˜çº§é…ç½®

### ç¯å¢ƒå˜é‡

```bash
# Google APIé…ç½®
GOOGLE_API_KEY=your_api_key_here

# ä½¿ç”¨Vertex AIï¼ˆå¯é€‰ï¼‰
GOOGLE_GENAI_USE_VERTEXAI=TRUE

# æœåŠ¡å™¨é…ç½®
HOST=localhost
PORT=10002
```

### è‡ªå®šä¹‰ç«¯å£è¿è¡Œ

```bash
uv run . --host 0.0.0.0 --port 8080
```

## ğŸ§ª å¼€å‘å’Œè°ƒè¯•

### å¯ç”¨è¯¦ç»†æ—¥å¿—

ä»£ç†é»˜è®¤å¯ç”¨INFOçº§åˆ«æ—¥å¿—ã€‚æŸ¥çœ‹è¯¦ç»†çš„è¯·æ±‚å¤„ç†è¿‡ç¨‹ï¼š

```bash
# æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
uv run . 2>&1 | tee agent.log
```

### è¡¨å•ç»“æ„ç¤ºä¾‹

ä»£ç†ç”Ÿæˆçš„è¡¨å•éµå¾ªJSON Schemaæ ¼å¼ï¼š

```json
{
  "type": "form",
  "form": {
    "type": "object",
    "properties": {
      "date": {
        "type": "string",
        "format": "date",
        "title": "Date",
        "description": "Date of expense"
      },
      "amount": {
        "type": "string",
        "format": "number", 
        "title": "Amount",
        "description": "Amount of expense"
      },
      "purpose": {
        "type": "string",
        "title": "Purpose",
        "description": "Purpose of expense"
      }
    },
    "required": ["date", "amount", "purpose"]
  }
}
```

## âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹

**é‡è¦æé†’**ï¼šæœ¬ç¤ºä¾‹ä»£ç ä»…ç”¨äºæ¼”ç¤º[Agent2Agent](https://a2aprotocol.ai/) ([A2A](https://a2aprotocol.ai/))åè®®çš„å·¥ä½œæœºåˆ¶ã€‚åœ¨æ„å»ºç”Ÿäº§åº”ç”¨æ—¶ï¼Œå¿…é¡»å°†ä»»ä½•å¤–éƒ¨ä»£ç†è§†ä¸ºæ½œåœ¨çš„ä¸å¯ä¿¡å®ä½“ã€‚

### å®‰å…¨æªæ–½

- **è¾“å…¥éªŒè¯**ï¼šå¯¹æ‰€æœ‰å¤–éƒ¨è¾“å…¥è¿›è¡Œä¸¥æ ¼éªŒè¯å’Œæ¶ˆæ¯’
- **æ•°æ®å¤„ç†**ï¼šè°¨æ…å¤„ç†ä»£ç†å¡ç‰‡ã€æ¶ˆæ¯ã€å·¥ä»¶ç­‰æ•°æ®
- **å‡­æ®ç®¡ç†**ï¼šå®æ–½é€‚å½“çš„å‡­æ®ä¿æŠ¤æªæ–½
- **æƒé™æ§åˆ¶**ï¼šé™åˆ¶ä»£ç†çš„è®¿é—®æƒé™å’Œæ“ä½œèŒƒå›´

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueså’ŒPull Requestsæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ã€‚

## ğŸ“„ è®¸å¯è¯

è¯·å‚è€ƒé¡¹ç›®è®¸å¯è¯æ–‡ä»¶äº†è§£ä½¿ç”¨æ¡æ¬¾ã€‚
